# Security_Vulnerability_Check_inDocker


í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆë‚´ì—ì„œ ê¸°ë³¸ì ì¸ ë³´ì•ˆ ì·¨ì•½ì ì„ í•´ê²°í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” Dockerfile ì…ë‹ˆë‹¤.

í•´ë‹¹ Dockerfileë¡œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ ê¸°ë³¸ì ì¸ ë³´ì•ˆ ì·¨ì•½ì ì„ í•´ê²° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ëŠ” Dockerfile, README.md, base.py, linux_vuln_check_script.sh, requirements.txt ê°€ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.

ê° íŒŒì¼ë³„ ìš©ë„ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
- Dockerfile : docker imageë¥¼ ë§Œë“¤ê¸° ìœ„í•œ fileë¡œ ë³´ì•ˆì·¨ì•½ì ì„ í•´ê²°í•  ìˆ˜ ìˆë„ë¡ RUN ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ìŠ¤í¬ë¦½íŠ¸í™” í–ˆìŠµë‹ˆë‹¤.
- base.py : ë„ì»¤ ì»¨í…Œì´ë„ˆë‚´ì—ì„œ python file ì„ ëŒë¦¬ëŠ” ëª©ì ì´ì˜€ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•  python file ì…ë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ ë§ê²Œ ìˆ˜ì • í˜¹ì€ ë‹¤ë¥¸ íŒŒì¼ì„ ì¶”ê°€í•´ë„ ë¬¸ì œ ì—†ìŠµë‹ˆë‹¤.
- linux_vuln_check_script.sh : ê¸°ë³¸ì ì¸ ë³´ì•ˆ ì·¨ì•½ì ì„ í™•ì¸ í•  ìˆ˜ ìˆëŠ” ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ (https://github.com/newbieh4cker/centos_vuln_check_script) ê°€ ì›ë³¸ì…ë‹ˆë‹¤.
- requirements.txt : ë„ì»¤ ì»¨í…Œì´ë„ˆë‚´ì—ì„œ ì‚¬ìš©í•  python ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.


# ì‚¬ìš©ë²•
í•´ë‹¹ ë””ë ‰í† ë¦¬ë‚´ì—ì„œ ( ./Security_Vulnerability_Check_inDocker ) 

ë„ì»¤ì´ë¯¸ì§€ ìƒì„± ëª…ë ¹ì–´ : ``` docker build -t "docker_images_name:image_tag" . ```

ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ docker_images_name:image_tag ë¡œ ë„ì»¤ ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ê³ , ì´ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë°”ê¿”ì£¼ê²Œ ë˜ë©´ ì»¨í…Œì´ë„ˆê¹Œì§€ ìƒì„±ë©ë‹ˆë‹¤.

ë„ì»¤ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ìƒì„± ëª…ë ¹ì–´ : ``` docker run -it  -d "docker_images_name:image_tag"  ```

ë„ì»¤ì»¨í…Œì´ë„ˆ ì ‘ì† ëª…ë ¹ì–´ : ``` docker exec -it  "docker_images_name:image_tag"  \bin\bash ```

ì´ì œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ``` source linux_vuln_check_script.sh  ``` ë¥¼ í†µí•´ì„œ ë³´ì•ˆ ì·¨ì•½ì ì„ í•œë²ˆë” í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# Dockerfile ìƒì„¸íˆë³´ê¸° 

## ğŸ” root ì½˜ì†”ì™¸ì— ì™¸ë¶€ì ‘ì† ê¸ˆì§€

```
## root ê³„ì • ì›ê²© ì ‘ì† ì œí•œ
## [ì·¨ì•½] ì½˜ì†” ë¡œê·¸ì¸ ì´ì™¸ì˜ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•œê²ƒ ì œì™¸
RUN apt-get install -y openssh-server
RUN mkdir /var/run/sshd

#set password
RUN echo 'root:root' |chpasswd

#replace sshd_config
RUN sed -ri 's/^#?PermitRootLogin\s+.*/PermitRootLogin no/' /etc/ssh/sshd_config

RUN /etc/init.d/ssh restart
```

ssh serviceë¥¼ ì„¤ì¹˜í•˜ê³  /etc/ssh/sshd_config file ë‚´ì— PermitRootLogin option ì„ no ë¡œ ë°”ê¿”ì¤Œìœ¼ë¡œì¨ ì½˜ì†”ì™¸ ì™¸ë¶€ì ‘ì†ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.

## ğŸ” ë¦¬ëˆ…ìŠ¤ ê³„ì • ì ê¸ˆ ì…ê³„ê°’ ì„¤ì • 

```
## ë¦¬ëˆ…ìŠ¤ ê³„ì • ì ê¸ˆ ì„ê³„ê°’ ì„¤ì •
## [ì·¨ì•½] ê³„ì • ì ê¸ˆ ì •ì±…ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì•„ ì„¤ì •
RUN echo 'auth required /lib/security/pam_tally.so deny=5 unlock_time=120 no_magic_root \n account required /lib/security/pam_tally.so no_magic_root reset' >> /etc/pam.d/system-auth
```

Docker container ë‚´ /etc/pam.d/system-auth íŒŒì¼ì—  ê³„ì • ì ê¸ˆ ì„ê³„ê°’ ì„¤ì •í•©ë‹ˆë‹¤.
- no_magic_root : rootì—ê²ŒëŠ” íŒ¨ìŠ¤ì›Œë“œ ì ê¸ˆ ì„¤ì •ì„ ì ìš©í•˜ì§€ ì•ŠìŒ
- deny=5 : 5íšŒ ì…ë ¥ ì‹¤íŒ¨ ì‹œ íŒ¨ìŠ¤ì›Œë“œ ì ê¸ˆ
- unlock_time=120 : ê³„ì • ì ê¹€ í›„ ë§ˆì§€ë§‰ ê³„ì • ì‹¤íŒ¨ ì‹œê°„ë¶€í„° ì„¤ì •ëœ ì‹œê°„(120ì´ˆ)ê°€ ì§€ë‚˜ë©´ ìë™ ê³„ì •ì ê¹€ í•´ì œ
- reset : ì ‘ì† ì‹œë„ ì„±ê³µì‹œ ì‹¤íŒ¨í•œ íšŸìˆ˜ ì´ˆê¸°í™”

## ğŸ” etc/passwd /etc/shadow ê¶Œí•œ ìˆ˜ì • 

```
## shadow , passwd íŒŒì¼ ê¶Œí•œ ë³€ê²½
RUN chmod 400 /etc/shadow
RUN chown root:root /etc/shadow
RUN chmod 400 /etc/passwd
```

ì‚¬ìš©ìì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ í•´ì‹œë¡œ ì•”í˜¸í™”í•œ ê°’ì´ ì €ì¥ëœ íŒŒì¼ë“¤ root ê¶Œí•œë§Œ read í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.


## ğŸ” /etc/(x)inetd.conf  íŒŒì¼ ê¶Œí•œ  ì„¤ì •

```
## /etc/(x)inetd.conf  íŒŒì¼ ê¶Œí•œ  ì„¤ì •
RUN apt-get install xinetd -y
RUN apt-get install openbsd-inetd -y
RUN chown root /etc/inetd.conf
RUN chmod 600 /etc/inetd.conf
RUN chown root /etc/xinetd.conf
RUN chmod 600 /etc/xinetd.conf
```

ì¸ê°€ìê°€ ì•…ì˜ì ì¸ í”„ë¡œê·¸ë¨ì„ ë“±ë¡í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ì‹œì¼œ ê¸°ì¡´ ì„œë¹„ìŠ¤ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆì–´ rootë§Œ read write í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

## ğŸ” /etc/hosts 

```
## host ê¶Œí•œ ë³€ê²½
RUN chmod 600 /etc/hosts
```

DNSì„œë²„ ì°¸ì¡° ì „ /etc/hosts íŒŒì¼ì— ì í˜€ìˆëŠ”Â domainê³¼ IPì£¼ì†Œë¥¼ ì°¸ì¡°í•´ í•´ë‹¹ ë„ë©”ì¸ì„ ì°¾ì•„ê°ˆ ë•Œ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ì„ root ê¶Œí•œë§Œ read write 


## ğŸ” /etc/(r)syslog.conf 

```
## /etc/(r)syslog.conf íŒŒì¼ ì†Œìœ ì ë° ê¶Œí•œ ì„¤ì •
RUN apt-get install rsyslog -y
RUN chown root /etc/rsyslog.conf
RUN chmod 644 /etc/rsyslog.conf
```

ë¡œê·¸ ê¸°ë¡ ì„¤ì • íŒŒì¼ë¡œ ê´€ë¦¬ìì™¸ ë³€ê²½ê¸ˆì§€í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.


## ğŸ” DoS ê³µê²©ì— ì·¨ì•½í•œ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”


```
## echo, discard, daytime, chargen ì™€ ê°™ì€ Dosì— ì·¨ì•½í•œ ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”
RUN echo 'service echo \n { \n disable=yes \n id = echo-stream \n type = INTERNAL \n wait = no \n socket_type = stream \n }' >> /etc/xinetd.d/echo
RUN echo 'service echo \n { \n disable=yes \n id = echo-stream \n type = INTERNAL \n wait = no \n socket_type = stream \n }' >> /etc/xinetd.d/daytime
RUN echo 'service echo \n { \n disable=yes \n id = echo-stream \n type = INTERNAL \n wait = no \n socket_type = stream \n }' >> /etc/xinetd.d/discard
RUN echo 'service echo \n { \n disable=yes \n id = echo-stream \n type = INTERNAL \n wait = no \n socket_type = stream \n }' >> /etc/xinetd.d/chargen
RUN echo 'service echo \n { \n disable=yes \n wait = yes \n socket_type = stream \n protocol = udp \n user = root \n server = /usr/sbin/in.tftpd \n server_args = -s /tftpd \n }' >> /etc/xinetd.d/tftp
RUN echo 'service echo \n { \n disable=yes \n wait = yes \n socket_type = stream \n protocol = udp \n user = root \n server = /usr/sbin/in.tftpd \n server_args = -s /tftpd \n }' >> /etc/xinetd.d/talk
RUN service xinetd restart
RUN sed -ri 's/^#?echo/#echo/' /etc/services
RUN sed -ri 's/^#?discard/#discard/' /etc/services
RUN sed -ri 's/^#?daytime/#daytime/' /etc/services
RUN sed -ri 's/^#?chargen/#chargen/' /etc/services
RUN sed -ri 's/^#?tftp/#tftp/' /etc/services
RUN sed -ri 's/^#?talk/#talk/' /etc/services
```

/etc/services ë‚´ ì£¼ì„ì²˜ë¦¬
/etc/xinetd.d/ ë‚´ì— íŒŒì¼ ìƒì„± ë° ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” 
- echo    ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” 
- discard    ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” 
- daytime    ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” 
- chargen    ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” 
- Tftp ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”
- Talk ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”

